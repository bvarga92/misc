clear all;
clc;

ciphertext=sprintf('AOPZ PZ H AVW ZLJYLA TLZZHNL.\nJYFWAVNYHWOF PZ MBU. :)')

%% monogramokbol minimalis Kullback-Leibler-divergenciaju eloszlas keresese, illetve khi-negyzet proba
letterDistribution=[0.08167 0.01492 0.02782 0.04253 0.12702 0.02228 ...
    0.02015 0.06094 0.06966 0.00153 0.00772 0.04025 0.02406 0.06749 ...
    0.07507 0.01929 0.00095 0.05987 0.06327 0.09056 0.02758 0.00978 ...
    0.02360 0.00150 0.01974 0.00074]; % betuk eloszlasa a-tol z-ig az angol szovegben

KLD=zeros(26,1);
chi2=zeros(26,1);
for shift=0:25
    letters=lower(ciphertext)-'a';
    letters=letters(letters>=0 & letters<=25);
    letters=mod(letters+shift,26);
    distribution=zeros(1,26);
    for letter=0:25
        distribution(letter+1)=sum(letters==letter)/length(letters);
    end
    KLD(shift+1)=sum(distribution.*log10(max(distribution./letterDistribution,eps)));
    chi2(shift+1)=sum((distribution-letterDistribution).^2./letterDistribution);
end

[~,shift_KLD]=min(KLD);
shift_KLD=shift_KLD-1;

[~,shift_chi2]=min(chi2);
shift_chi2=shift_chi2-1;

message_KLD=lower(ciphertext);
letterIdx=(message_KLD>='a' & message_KLD<='z');
message_KLD(letterIdx)=message_KLD(letterIdx)+shift_KLD;
message_KLD(letterIdx & message_KLD>'z')=message_KLD(letterIdx & message_KLD>'z')-26;
message_KLD=upper(char(message_KLD))

message_chi2=lower(ciphertext);
letterIdx=(message_chi2>='a' & message_chi2<='z');
message_chi2(letterIdx)=message_chi2(letterIdx)+shift_chi2;
message_chi2(letterIdx & message_chi2>'z')=message_chi2(letterIdx & message_chi2>'z')-26;
message_chi2=upper(char(message_chi2))

figure(1);
subplot(211);
plot(0:25,KLD);
hold on;
plot(shift_KLD,KLD(shift_KLD+1),'ro');
hold off;
xlim([0 25]);
xlabel('eltolas');
ylabel('D_{KL} (1-gram)');
subplot(212);
plot(0:25,chi2);
hold on;
plot(shift_chi2,chi2(shift_chi2+1),'ro');
hold off;
xlim([0 25]);
xlabel('eltolas');
ylabel('\chi^2 (1-gram)');

%% ugyanez bigramokkal
bigramDistribution={
    'th' , 2.705698e-02
    'he' , 2.328545e-02
    'in' , 2.027553e-02
    'er' , 1.783814e-02
    'an' , 1.613624e-02
    're' , 1.408922e-02
    'es' , 1.319814e-02
    'on' , 1.316225e-02
    'st' , 1.249232e-02
    'nt' , 1.172516e-02
    'en' , 1.132975e-02
    'at' , 1.116400e-02
    'ed' , 1.078783e-02
    'nd' , 1.068292e-02
    'to' , 1.066462e-02
    'or' , 1.057443e-02
    'ea' , 1.002047e-02
    'ti' , 9.918455e-03
    'ar' , 9.794637e-03
    'te' , 9.781351e-03
    'ng' , 8.919108e-03
    'al' , 8.836830e-03
    'it' , 8.773685e-03
    'as' , 8.735606e-03
    'is' , 8.637575e-03
    'ha' , 8.318866e-03
    'et' , 7.602123e-03
    'se' , 7.292169e-03
    'ou' , 7.195042e-03
    'of' , 7.062905e-03
    'le' , 7.026448e-03
    'sa' , 6.956346e-03
    've' , 6.780783e-03
    'ro' , 6.759923e-03
    'ra' , 6.624591e-03
    'ri' , 6.390801e-03
    'hi' , 6.358587e-03
    'ne' , 6.320737e-03
    'me' , 6.299012e-03
    'de' , 6.250933e-03
    'co' , 6.183235e-03
    'ta' , 6.046906e-03
    'ec' , 5.960924e-03
    'si' , 5.957003e-03
    'll' , 5.697536e-03
    'so' , 5.527966e-03
    'na' , 5.445612e-03
    'li' , 5.386327e-03
    'la' , 5.360229e-03
    'el' , 5.340325e-03
    'ma' , 5.048042e-03
    'di' , 5.012340e-03
    'ic' , 4.964796e-03
    'rt' , 4.961939e-03
    'ns' , 4.927334e-03
    'rs' , 4.911339e-03
    'io' , 4.905072e-03
    'om' , 4.871770e-03
    'ch' , 4.655910e-03
    'ot' , 4.645572e-03
    'ca' , 4.609196e-03
    'ce' , 4.579795e-03
    'ho' , 4.562545e-03
    'be' , 4.502293e-03
    'tt' , 4.478931e-03
    'fo' , 4.376321e-03
    'ts' , 4.376032e-03
    'ss' , 4.374453e-03
    'no' , 4.369462e-03
    'ee' , 4.277843e-03
    'em' , 4.196290e-03
    'ac' , 4.140646e-03
    'il' , 4.134383e-03
    'da' , 4.066497e-03
    'ni' , 4.035982e-03
    'ur' , 4.010454e-03
    'wa' , 3.894148e-03
    'sh' , 3.878962e-03
    'ei' , 3.706392e-03
    'am' , 3.694613e-03
    'tr' , 3.658825e-03
    'dt' , 3.644590e-03
    'us' , 3.630640e-03
    'lo' , 3.606811e-03
    'pe' , 3.601493e-03
    'un' , 3.523878e-03
    'nc' , 3.518541e-03
    'wi' , 3.518170e-03
    'ut' , 3.500629e-03
    'ad' , 3.440517e-03
    'ew' , 3.417199e-03
    'ow' , 3.378815e-03
    'ge' , 3.335938e-03
    'ep' , 3.243284e-03
    'ai' , 3.231847e-03
    'ly' , 3.177989e-03
    'ol' , 3.174395e-03
    'ft' , 3.167362e-03
    'os' , 3.144279e-03
    'eo' , 3.127610e-03
    'ef' , 3.064717e-03
    'pr' , 3.050599e-03
    'we' , 3.049197e-03
    'do' , 3.034212e-03
    'mo' , 2.995001e-03
    'id' , 2.982517e-03
    'ie' , 2.892039e-03
    'mi' , 2.814196e-03
    'pa' , 2.791016e-03
    'fi' , 2.773700e-03
    'po' , 2.756055e-03
    'ct' , 2.749399e-03
    'wh' , 2.741110e-03
    'ir' , 2.701436e-03
    'ay' , 2.664911e-03
    'ga' , 2.599319e-03
    'sc' , 2.497761e-03
    'ke' , 2.463079e-03
    'ev' , 2.445351e-03
    'sp' , 2.444568e-03
    'im' , 2.438508e-03
    'op' , 2.418859e-03
    'ds' , 2.412021e-03
    'ld' , 2.369398e-03
    'ul' , 2.352721e-03
    'oo' , 2.351655e-03
    'su' , 2.319775e-03
    'ia' , 2.313070e-03
    'gh' , 2.284946e-03
    'pl' , 2.269180e-03
    'eb' , 2.252199e-03
    'ig' , 2.204045e-03
    'vi' , 2.169232e-03
    'iv' , 2.111231e-03
    'wo' , 2.106008e-03
    'yo' , 2.101810e-03
    'rd' , 2.087273e-03
    'tw' , 2.060590e-03
    'ba' , 2.050694e-03
    'ag' , 2.037235e-03
    'ry' , 2.032442e-03
    'ab' , 2.029446e-03
    'ls' , 2.006289e-03
    'sw' , 2.005776e-03
    'ap' , 1.978182e-03
    'fe' , 1.972488e-03
    'tu' , 1.960510e-03
    'ci' , 1.953246e-03
    'fa' , 1.932859e-03
    'ht' , 1.931384e-03
    'fr' , 1.928568e-03
    'av' , 1.916892e-03
    'eg' , 1.916332e-03
    'go' , 1.893725e-03
    'bo' , 1.889952e-03
    'bu' , 1.876279e-03
    'ty' , 1.852146e-03
    'mp' , 1.811966e-03
    'oc' , 1.768438e-03
    'od' , 1.759942e-03
    'eh' , 1.748131e-03
    'ys' , 1.743617e-03
    'ey' , 1.741008e-03
    'rm' , 1.706237e-03
    'ov' , 1.699768e-03
    'gt' , 1.699300e-03
    'ya' , 1.674222e-03
    'ck' , 1.666253e-03
    'gi' , 1.642676e-03
    'rn' , 1.633771e-03
    'gr' , 1.616502e-03
    'rc' , 1.612825e-03
    'bl' , 1.605189e-03
    'lt' , 1.576566e-03
    'yt' , 1.552718e-03
    'oa' , 1.515732e-03
    'ye' , 1.503033e-03
    'ob' , 1.436709e-03
    'db' , 1.412243e-03
    'ff' , 1.407340e-03
    'sf' , 1.404675e-03
    'rr' , 1.363561e-03
    'du' , 1.355490e-03
    'ki' , 1.344631e-03
    'uc' , 1.327987e-03
    'if' , 1.327531e-03
    'af' , 1.318779e-03
    'dr' , 1.318619e-03
    'cl' , 1.314301e-03
    'ex' , 1.306475e-03
    'sm' , 1.290608e-03
    'pi' , 1.285626e-03
    'sb' , 1.284348e-03
    'cr' , 1.275251e-03
    'tl' , 1.249532e-03
    'oi' , 1.234149e-03
    'ru' , 1.232747e-03
    'up' , 1.227287e-03
    'by' , 1.209972e-03
    'tc' , 1.201819e-03
    'nn' , 1.198137e-03
    'ak' , 1.188057e-03
    'sl' , 1.148211e-03
    'nf' , 1.144817e-03
    'ue' , 1.139614e-03
    'dw' , 1.134752e-03
    'au' , 1.129515e-03
    'pp' , 1.127023e-03
    'ug' , 1.117526e-03
    'rl' , 1.110801e-03
    'rg' , 1.074422e-03
    'br' , 1.068673e-03
    'cu' , 1.064734e-03
    'ua' , 1.061485e-03
    'dh' , 1.060506e-03
    'rk' , 1.038683e-03
    'yi' , 1.031703e-03
    'lu' , 1.018226e-03
    'um' , 1.015169e-03
    'bi' , 1.007478e-03
    'ny' , 1.004431e-03
    'nw' , 9.749867e-04
    'qu' , 9.642231e-04
    'og' , 9.627666e-04
    'sn' , 9.615789e-04
    'mb' , 9.532012e-04
    'va' , 9.507987e-04
    'df' , 9.328767e-04
    'dd' , 9.253369e-04
    'ms' , 9.072014e-04
    'gs' , 9.066973e-04
    'aw' , 9.063007e-04
    'nh' , 9.054797e-04
    'pu' , 8.922373e-04
    'hr' , 8.887343e-04
    'sd' , 8.885607e-04
    'tb' , 8.823650e-04
    'pt' , 8.816749e-04
    'nm' , 8.780795e-04
    'dc' , 8.747385e-04
    'gu' , 8.714890e-04
    'tm' , 8.695074e-04
    'mu' , 8.685761e-04
    'nu' , 8.632034e-04
    'mm' , 8.627192e-04
    'nl' , 8.540416e-04
    'eu' , 8.496812e-04
    'wn' , 8.440118e-04
    'nb' , 8.331604e-04
    'rp' , 8.298062e-04
    'dm' , 8.197965e-04
    'sr' , 8.126050e-04
    'ud' , 8.093042e-04
    'ui' , 8.051293e-04
    'rf' , 7.946647e-04
    'ok' , 7.857238e-04
    'yw' , 7.814440e-04
    'tf' , 7.789899e-04
    'ip' , 7.744038e-04
    'rw' , 7.742613e-04
    'rb' , 7.738467e-04
    'oh' , 7.526741e-04
    'ks' , 7.463547e-04
    'dp' , 7.273242e-04
    'fu' , 7.259036e-04
    'yc' , 7.233951e-04
    'tp' , 7.100685e-04
    'mt' , 7.067196e-04
    'dl' , 7.055631e-04
    'nk' , 7.037720e-04
    'cc' , 6.999081e-04
    'ub' , 6.916696e-04
    'rh' , 6.865444e-04
    'np' , 6.864103e-04
    'ju' , 6.763942e-04
    'fl' , 6.685369e-04
    'dn' , 6.569006e-04
    'ka' , 6.551698e-04
    'ph' , 6.533905e-04
    'hu' , 6.410148e-04
    'jo' , 6.293396e-04
    'lf' , 6.249866e-04
    'yb' , 6.236601e-04
    'rv' , 6.226562e-04
    'oe' , 6.050487e-04
    'ib' , 6.009175e-04
    'ik' , 5.978371e-04
    'yp' , 5.970829e-04
    'gl' , 5.959091e-04
    'lp' , 5.883168e-04
    'ym' , 5.819146e-04
    'lb' , 5.697549e-04
    'hs' , 5.693694e-04
    'dg' , 5.647703e-04
    'gn' , 5.611372e-04
    'ek' , 5.577169e-04
    'nr' , 5.535405e-04
    'ps' , 5.497145e-04
    'td' , 5.426565e-04
    'lc' , 5.383890e-04
    'sk' , 5.369610e-04
    'yf' , 5.331119e-04
    'yh' , 5.298809e-04
    'vo' , 5.210974e-04
    'ah' , 5.146171e-04
    'dy' , 5.129450e-04
    'lm' , 5.125921e-04
    'sy' , 5.120732e-04
    'nv' , 5.075090e-04
    'yd' , 4.908127e-04
    'fs' , 4.734865e-04
    'sg' , 4.726433e-04
    'yr' , 4.675946e-04
    'yl' , 4.657445e-04
    'ws' , 4.599140e-04
    'my' , 4.507566e-04
    'oy' , 4.470016e-04
    'kn' , 4.402821e-04
    'iz' , 4.314863e-04
    'xp' , 4.256803e-04
    'lw' , 4.247818e-04
    'tn' , 4.121337e-04
    'ko' , 4.065562e-04
    'aa' , 3.980324e-04
    'ja' , 3.960944e-04
    'ze' , 3.954256e-04
    'fc' , 3.632619e-04
    'gw' , 3.626144e-04
    'tg' , 3.538390e-04
    'xt' , 3.491962e-04
    'fh' , 3.486493e-04
    'lr' , 3.480683e-04
    'je' , 3.439648e-04
    'yn' , 3.435733e-04
    'gg' , 3.395566e-04
    'gf' , 3.388637e-04
    'eq' , 3.379724e-04
    'hy' , 3.345070e-04
    'kt' , 3.339367e-04
    'hc' , 3.332596e-04
    'bs' , 3.260015e-04
    'hw' , 3.245101e-04
    'hn' , 3.200548e-04
    'cs' , 3.195114e-04
    'hm' , 3.128957e-04
    'nj' , 3.105216e-04
    'hh' , 3.075760e-04
    'wt' , 3.009377e-04
    'gc' , 3.005325e-04
    'lh' , 2.946370e-04
    'ej' , 2.906928e-04
    'fm' , 2.893790e-04
    'dv' , 2.864312e-04
    'lv' , 2.863669e-04
    'wr' , 2.837000e-04
    'gp' , 2.810287e-04
    'fp' , 2.774768e-04
    'gb' , 2.738996e-04
    'gm' , 2.725430e-04
    'hl' , 2.704518e-04
    'lk' , 2.692302e-04
    'cy' , 2.648664e-04
    'mc' , 2.547859e-04
    'yg' , 2.426112e-04
    'xi' , 2.369810e-04
    'hb' , 2.344991e-04
    'fw' , 2.326256e-04
    'gy' , 2.265900e-04
    'hp' , 2.263229e-04
    'mw' , 2.168347e-04
    'pm' , 2.153556e-04
    'za' , 2.148685e-04
    'lg' , 2.142564e-04
    'iw' , 2.132358e-04
    'xa' , 2.090937e-04
    'fb' , 2.053952e-04
    'sv' , 2.039910e-04
    'gd' , 2.034611e-04
    'ix' , 2.033612e-04
    'aj' , 2.012572e-04
    'kl' , 1.957178e-04
    'hf' , 1.929369e-04
    'hd' , 1.916583e-04
    'ae' , 1.887000e-04
    'sq' , 1.850884e-04
    'dj' , 1.848618e-04
    'fy' , 1.826868e-04
    'az' , 1.776911e-04
    'ln' , 1.739810e-04
    'ao' , 1.733450e-04
    'fd' , 1.729891e-04
    'kw' , 1.664227e-04
    'mf' , 1.653714e-04
    'mh' , 1.643948e-04
    'sj' , 1.629096e-04
    'uf' , 1.623199e-04
    'tv' , 1.614545e-04
    'xc' , 1.614187e-04
    'yu' , 1.608445e-04
    'bb' , 1.593750e-04
    'ww' , 1.560106e-04
    'oj' , 1.528822e-04
    'ax' , 1.528230e-04
    'mr' , 1.527751e-04
    'wl' , 1.521190e-04
    'xe' , 1.512321e-04
    'kh' , 1.503413e-04
    'ox' , 1.503374e-04
    'uo' , 1.502976e-04
    'zi' , 1.489399e-04
    'fg' , 1.474882e-04
    'ih' , 1.412269e-04
    'tk' , 1.411459e-04
    'ii' , 1.404038e-04
    'iu' , 1.333640e-04
    'tj' , 1.293840e-04
    'mn' , 1.291352e-04
    'wy' , 1.280367e-04
    'ky' , 1.279555e-04
    'kf' , 1.242660e-04
    'fn' , 1.235768e-04
    'uy' , 1.230213e-04
    'pw' , 1.226631e-04
    'dk' , 1.215838e-04
    'rj' , 1.198292e-04
    'uk' , 1.190698e-04
    'kr' , 1.172537e-04
    'ku' , 1.171607e-04
    'wm' , 1.169454e-04
    'km' , 1.123040e-04
    'md' , 1.112654e-04
    'ml' , 1.106646e-04
    'ez' , 1.076439e-04
    'kb' , 1.058849e-04
    'wc' , 1.036958e-04
    'wd' , 1.000539e-04
    'hg' , 9.935113e-05
    'bt' , 9.904332e-05
    'zo' , 9.805815e-05
    'kc' , 9.713334e-05
    'pf' , 9.670574e-05
    'yv' , 9.516069e-05
    'pc' , 9.257543e-05
    'py' , 9.161315e-05
    'wb' , 9.130627e-05
    'yk' , 9.064325e-05
    'cp' , 8.855497e-05
    'yj' , 8.757350e-05
    'kp' , 8.687370e-05
    'pb' , 8.541283e-05
    'cd' , 8.289186e-05
    'ji' , 8.269344e-05
    'uw' , 8.157298e-05
    'uh' , 7.847617e-05
    'wf' , 7.775279e-05
    'yy' , 7.700350e-05
    'wp' , 7.440714e-05
    'bc' , 7.409124e-05
    'aq' , 7.286278e-05
    'cb' , 6.892789e-05
    'iq' , 6.744366e-05
    'cm' , 6.612709e-05
    'mg' , 6.594000e-05
    'dq' , 6.551934e-05
    'bj' , 6.535607e-05
    'tz' , 6.475456e-05
    'kd' , 6.428626e-05
    'pd' , 6.317158e-05
    'fj' , 6.240912e-05
    'cf' , 6.189225e-05
    'nz' , 6.162191e-05
    'cw' , 5.949246e-05
    'fv' , 5.658598e-05
    'vy' , 5.390266e-05
    'fk' , 5.293669e-05
    'oz' , 5.285598e-05
    'zz' , 5.117217e-05
    'ij' , 5.067565e-05
    'lj' , 5.049851e-05
    'nq' , 5.028112e-05
    'uv' , 4.903902e-05
    'xo' , 4.883597e-05
    'pg' , 4.882672e-05
    'hk' , 4.865374e-05
    'kg' , 4.839496e-05
    'vs' , 4.719865e-05
    'hv' , 4.568297e-05
    'bm' , 4.435738e-05
    'hj' , 4.391776e-05
    'cn' , 4.348761e-05
    'gv' , 4.319414e-05
    'cg' , 4.199459e-05
    'wu' , 4.183133e-05
    'gj' , 4.092085e-05
    'xh' , 3.852777e-05
    'gk' , 3.788741e-05
    'tq' , 3.679609e-05
    'cq' , 3.643417e-05
    'rq' , 3.629240e-05
    'bh' , 3.572720e-05
    'xs' , 3.569437e-05
    'uz' , 3.555306e-05
    'wk' , 3.444949e-05
    'xu' , 3.411856e-05
    'ux' , 3.348976e-05
    'bd' , 3.278164e-05
    'bw' , 3.242018e-05
    'wg' , 3.235103e-05
    'mv' , 3.152404e-05
    'mj' , 3.104973e-05
    'pn' , 3.044429e-05
    'xm' , 2.948386e-05
    'oq' , 2.837034e-05
    'bv' , 2.776999e-05
    'xw' , 2.759447e-05
    'kk' , 2.747629e-05
    'bp' , 2.663219e-05
    'zu' , 2.625686e-05
    'rz' , 2.623234e-05
    'xf' , 2.613961e-05
    'mk' , 2.567940e-05
    'zh' , 2.489265e-05
    'bn' , 2.454252e-05
    'zy' , 2.448378e-05
    'hq' , 2.341304e-05
    'wj' , 2.299539e-05
    'iy' , 2.274701e-05
    'dz' , 2.267232e-05
    'vr' , 2.229721e-05
    'zs' , 2.196813e-05
    'xy' , 2.181457e-05
    'cv' , 2.179029e-05
    'xb' , 2.174797e-05
    'xr' , 2.082408e-05
    'uj' , 2.038978e-05
    'yq' , 2.034006e-05
    'vd' , 1.979844e-05
    'pk' , 1.919855e-05
    'vu' , 1.915531e-05
    'jr' , 1.860976e-05
    'zl' , 1.850986e-05
    'sz' , 1.846384e-05
    'yz' , 1.810330e-05
    'lq' , 1.784129e-05
    'kj' , 1.776451e-05
    'bf' , 1.742594e-05
    'nx' , 1.730846e-05
    'qa' , 1.700389e-05
    'qi' , 1.697151e-05
    'kv' , 1.692457e-05
    'zw' , 1.592575e-05
    'wv' , 1.478448e-05
    'uu' , 1.457936e-05
    'vt' , 1.454906e-05
    'vp' , 1.447159e-05
    'xd' , 1.389899e-05
    'gq' , 1.381782e-05
    'xl' , 1.377966e-05
    'vc' , 1.364992e-05
    'cz' , 1.339322e-05
    'lz' , 1.325446e-05
    'zt' , 1.317144e-05
    'wz' , 1.221888e-05
    'sx' , 1.178850e-05
    'zb' , 1.171381e-05
    'vl' , 1.133917e-05
    'pv' , 1.112479e-05
    'fq' , 1.098580e-05
    'pj' , 1.087919e-05
    'zm' , 1.064585e-05
    'vw' , 1.054733e-05
    'cj' , 9.603324e-06
    'zc' , 9.490237e-06
    'bg' , 9.369751e-06
    'js' , 9.094551e-06
    'xg' , 9.085994e-06
    'rx' , 8.939144e-06
    'hz' , 8.571902e-06
    'xx' , 8.106143e-06
    'vm' , 8.099668e-06
    'xn' , 8.032602e-06
    'qw' , 8.017570e-06
    'jp' , 7.983113e-06
    'vn' , 7.650560e-06
    'zd' , 7.609858e-06
    'zr' , 7.558750e-06
    'fz' , 7.212090e-06
    'xv' , 7.196133e-06
    'zp' , 7.027775e-06
    'vh' , 6.984761e-06
    'vb' , 6.750957e-06
    'zf' , 6.627464e-06
    'gz' , 6.594162e-06
    'tx' , 6.511371e-06
    'vf' , 6.496108e-06
    'dx' , 6.339544e-06
    'qb' , 6.315031e-06
    'bk' , 6.242415e-06
    'zg' , 6.098108e-06
    'vg' , 5.916800e-06
    'jc' , 5.728323e-06
    'zk' , 5.610842e-06
    'zn' , 5.605986e-06
    'uq' , 5.408258e-06
    'jm' , 5.165897e-06
    'vv' , 5.163816e-06
    'jd' , 5.065299e-06
    'mq' , 4.939262e-06
    'jh' , 4.847220e-06
    'qs' , 4.821088e-06
    'jt' , 4.719564e-06
    'jb' , 4.481829e-06
    'fx' , 4.466334e-06
    'pq' , 4.303064e-06
    'mz' , 4.225361e-06
    'yx' , 3.918709e-06
    'qt' , 3.911540e-06
    'wq' , 3.756827e-06
    'jj' , 3.719825e-06
    'jw' , 3.719363e-06
    'lx' , 3.576906e-06
    'gx' , 3.417568e-06
    'jn' , 3.342177e-06
    'zv' , 3.316044e-06
    'mx' , 3.295462e-06
    'jk' , 3.230015e-06
    'kq' , 3.215677e-06
    'xk' , 3.156937e-06
    'jf' , 2.923133e-06
    'qm' , 2.847973e-06
    'qh' , 2.838260e-06
    'jl' , 2.809584e-06
    'jg' , 2.780445e-06
    'vk' , 2.652327e-06
    'vj' , 2.643770e-06
    'kz' , 2.588268e-06
    'qc' , 2.466856e-06
    'xj' , 2.458068e-06
    'pz' , 2.242533e-06
    'ql' , 2.220795e-06
    'qo' , 2.172461e-06
    'jv' , 2.064000e-06
    'qf' , 2.030005e-06
    'qd' , 2.006879e-06
    'bz' , 1.880610e-06
    'hx' , 1.740467e-06
    'zj' , 1.657444e-06
    'px' , 1.575809e-06
    'qp' , 1.401901e-06
    'qe' , 1.392188e-06
    'qr' , 1.381782e-06
    'zq' , 1.335067e-06
    'jy' , 1.323504e-06
    'bq' , 1.274939e-06
    'xq' , 1.252507e-06
    'cx' , 1.225681e-06
    'kx' , 1.175497e-06
    'wx' , 1.081837e-06
    'qy' , 1.053854e-06
    'qv' , 9.740692e-07
    'qn' , 8.806400e-07
    'vx' , 7.381835e-07
    'bx' , 6.986380e-07
    'jz' , 6.611738e-07
    'vz' , 6.089089e-07
    'qg' , 5.936457e-07
    'qq' , 5.779200e-07
    'zx' , 5.695946e-07
    'xz' , 4.814844e-07
    'qk' , 4.678400e-07
    'vq' , 3.441156e-07
    'qj' , 3.103516e-07
    'qx' , 1.769143e-07
    'jx' , 1.727516e-07
    'jq' , 1.669701e-07
    'qz' , 6.475294e-08
}; % bigramok eloszlasa az angol nyelvu szovegben

KLD_2=zeros(26,1);
chi2_2=zeros(26,1);
for shift=0:25
    letters=lower(ciphertext)-'a';
    letters=letters(letters>=0 & letters<=25);
    letters=char(mod(letters+shift,26)+'a');
    distribution=zeros(1,26*26);
    for ii=1:length(letters)-1
        idx=strcmp(bigramDistribution,letters(ii:ii+1));
        idx=find(idx(:,1));
        distribution(idx)=distribution(idx)+1;
    end
    distribution=distribution/sum(distribution);
    KLD_2(shift+1)=sum(distribution.*log10(max(distribution./cat(1,bigramDistribution{:,2})',eps)));
    chi2_2(shift+1)=sum((distribution-cat(1,bigramDistribution{:,2})').^2./cat(1,bigramDistribution{:,2})');
end

[~,shift_KLD_2]=min(KLD_2);
shift_KLD_2=shift_KLD_2-1;

[~,shift_chi2_2]=min(chi2_2);
shift_chi2_2=shift_chi2_2-1;

message_KLD_2=lower(ciphertext);
letterIdx=(message_KLD_2>='a' & message_KLD_2<='z');
message_KLD_2(letterIdx)=message_KLD_2(letterIdx)+shift_KLD_2;
message_KLD_2(letterIdx & message_KLD_2>'z')=message_KLD_2(letterIdx & message_KLD_2>'z')-26;
message_KLD_2=upper(char(message_KLD_2))

message_chi2_2=lower(ciphertext);
letterIdx=(message_chi2_2>='a' & message_chi2_2<='z');
message_chi2_2(letterIdx)=message_chi2_2(letterIdx)+shift_chi2_2;
message_chi2_2(letterIdx & message_chi2_2>'z')=message_chi2_2(letterIdx & message_chi2_2>'z')-26;
message_chi2_2=upper(char(message_chi2_2))

figure(2);
subplot(211);
plot(0:25,KLD_2);
hold on;
plot(shift_KLD_2,KLD_2(shift_KLD_2+1),'ro');
hold off;
xlim([0 25]);
xlabel('eltolas');
ylabel('D_{KL} (2-gram)');
subplot(212);
plot(0:25,chi2_2);
hold on;
plot(shift_chi2_2,chi2_2(shift_chi2_2+1),'ro');
hold off;
xlim([0 25]);
xlabel('eltolas');
ylabel('\chi^2 (2-gram)');